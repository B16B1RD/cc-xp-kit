---
description: 実装/挙動をレビューし、バグや改善点を分析する。コードは一切変更せず、docs/xp/reports/bugs/ に分析ファイルを保存する。
argument-hint: '[任意] レビューの対象や観点（例: "スコア保存の不具合"）'
# コードやテストを変更しないため、docs配下以外への書き込みを禁止する
allowed-tools: Read(*), Write(docs/xp/**), Edit(docs/xp/**), MultiEdit(docs/xp/**)
---
# /xp:review

## Goal

- 指定の観点でレビューを実施し、問題の**再現手順・期待/実際・証拠・原因仮説**を整理する
- 結果を **docs/xp/reports/bugs/** に**バグ分析アーティファクト**として保存する
- TDD 修正のための **失敗テスト案** を具体化する
- **ソースコードやテストファイルを一切変更しない**

## Inputs

- 必要に応じて、実装・テスト・ログ・ドキュメントを参照する（読み取りのみ）
  - 例：src/**, tests/**, docs/xp/architecture.md, docs/xp/discovery-intent.yaml
- 引数 "$ARGUMENTS" があれば、分析タイトルに反映する

## Tasks

1. レビュー観点の確定  
   - レビュー対象の範囲/前提/想定動作を簡潔にまとめる

2. バグ/課題の分析（**自然文**）
   - 再現手順（Step by step）
   - 期待結果 vs 実際結果
   - 影響範囲・ユーザー影響
   - 証拠（ログ断片・スクショの指示・該当関数やテストのリファレンス）
   - **原因仮説候補（confidence付き）**：{候補, 根拠, 信頼度}
   - 関連ファイル候補（パス一覧、**編集はしない**）

3. 失敗テスト案（**TDDで先に書くべき**）
   - テスト名/目的
   - 前提データ/前提状態
   - 操作/入力
   - 期待アサーション
   - 既存テストとの衝突/重複有無

4. バグ分析アーティファクトの保存（**ファイル出力**）
   - **バグID**を発行：`bug-YYYYMMDD-HHMM-<slug>`（slugは引数または観点から生成）
   - 保存先ディレクトリ：`docs/xp/reports/bugs/<bug-id>/`
   - 以下の**2ファイル**を出力（自然文＋機械可読の両方）
     - `analysis.md`：人間向けまとめ（上記の内容を章立てで記載）
     - `analysis.yaml`：機械可読（下記テンプレ構造に準拠）

5. 次の推奨コマンド（**自然文＋（相当コマンド）**）
   - **このバグをTDDで修正する**：`/xp:tdd "bug:<bug-id>"` を案内  
   - （相当コマンド：バグIDを引数に渡して TDD 実行）

## Output

- 保存先：`docs/xp/reports/bugs/<bug-id>/analysis.md` と `analysis.yaml` を作成
- 作成ファイルの一覧とバグIDを表示
- **注意**：本コマンドは **src/** や **tests/** を変更しない（編集禁止）

## Notes

- レビュー中に修正点が明らかでも、**ここでは直さない**。必ず `/xp:tdd` に引き継ぐ
- 何度でも再実行可能。既存バグIDに追記が必要な場合は、同じID配下のファイルに追記（docs配下のみ許可）
