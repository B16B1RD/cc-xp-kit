# 🔴🟢🔵 TDD原則 - 絶対厳守

## Kent Beck's Red-Green-Refactor Cycle

```
🔴 Red   → 失敗するテストを書く（設計を明確化）
🟢 Green → テストを通す最小限のコード（機能を実装）
🔵 Refactor → 構造を改善（品質を向上）
```

**TDDの本質**: テストはドキュメントであり、仕様であり、設計手法である。

## 🚫 絶対禁止事項

### TDD原則の厳守

1. **テストなしの実装** - 実装前に必ずテストを書く
2. **TODOテストの作成** - expect(true).toBe(false)のような無意味なテスト禁止
3. **複数テストの一括作成** - 一度に1つのテストのみ作成
4. **手動テストへの依存** - 自動テストのみが真実
5. **テストを通すためのテスト修正** - テストは仕様、変更不可
6. **複数機能の同時実装** - 一度に 1 つの振る舞いのみ
7. **Greenを飛ばしてのRefactor** - 必ず Green 状態でリファクタリング

### テスト修正の絶対禁止（Kent Beck原則）

**テストは仕様書です。テストを修正することは仕様を歪めることです。**

#### ⛔ 絶対禁止事項

1. **テストを通すためのテスト修正**
   - アサーションの期待値変更
   - テストの削除・コメントアウト
   - テストのスキップ（.skip(), @Ignore 等）
   - 期待値の緩和・変更

2. **Greenフェーズでのテスト変更**
   - テストファイルの編集
   - 新規テストの追加
   - テストの構造変更

#### ✅ 正しい対応方法

**テストが失敗した場合**:
1. **実装コードを修正する**（テストは触らない）
2. テストが本当に間違っている場合：
   - 新しい正しいテストを書く
   - 古いテストは残す（削除しない）
   - 両方のテストが通るよう実装を調整

**テスト設計を見直したい場合**:
1. 現在の TDD サイクルを完了させる
2. 新しい Red フェーズで新しいテストを書く
3. 古いテストとの整合性を保つ

## コミット規律

すべてのコミットは以下のプレフィックスを使用：

```bash
[Red] テスト追加
[Green] 実装
[Refactor] リファクタリング
[Structure] 構造的変更（振る舞い不変）
```

## t-wada式「最小限実装」原則

**「動作するきれいなコード」へ、2つのステップで到達する**

### 最小限実装の重要性

```javascript
// 正しい最小限実装の例
function add(a, b) {
  return 2; // 最初は固定値でOK！
}

// 次のテストで一般化
function add(a, b) {
  return a + b; // 三角測量で一般化
}
```

### 最小限実装の意図

1. **設計の発見**: 実装詳細に囚われず、インターフェースを先に確定
2. **過剰設計の防止**: 必要になるまで複雑にしない
3. **フィードバックループの高速化**: Red→Greenを2、3分で回す
4. **不安の解消**: 小さな成功体験の積み重ね

### 三角測量の原則

```javascript
// STEP 1: 最初のテスト
test('1 + 1 = 2', () => {
  expect(add(1, 1)).toBe(2);
});
// 仮実装: return 2; ← これでOK！

// STEP 2: 三角測量
test('2 + 3 = 5', () => {
  expect(add(2, 3)).toBe(5);
});
// 一般化: return a + b; ← ここで一般化
```

### 小さなステップの利点

- **設計の明確化**: 1 つずつ要求を明確にする
- **リスクの最小化**: 失敗時の影響範囲を限定
- **継続的なフィードバック**: 各ステップで品質確認
- **デバッグの簡素化**: 問題の特定が容易
- **勇気の獲得**: 完璧でなくても前進できることを体感

## インクリメンタル開発原則

**厳格なルール**:
1. **1つのテストを書く** → **そのテストを通す** → **構造を改善する**
2. **複数機能の同時実装は禁止**
3. **一度に1つの振る舞いのみ**
4. **最小限の進歩を積み重ねる**