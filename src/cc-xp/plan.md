---
description: XP plan – ユーザー要求から価値あるストーリーを抽出
argument-hint: '"ウェブブラウザで遊べるテトリスが欲しい"'
allowed-tools: Bash(date), Bash(echo), Bash(git:*), Bash(test), Bash(mkdir:*), Bash(cat), ReadFile, WriteFile
---

## ゴール

ユーザー要求「$ARGUMENTS」の**真の目的**を理解し、価値あるストーリーセットを生成する。

## 3段階要求分析プロセス

### Stage 1: 真の目的分析

表面的な要求の背後にある本当のニーズを探る：
- **現状の不満**: なぜこの要求が生まれたか
- **真の達成目標**: 本当に解決したい問題は何か
- **成功のイメージ**: 実現時にユーザーが感じる価値

### Stage 2: ペルソナ特定

要求に関わる主要な関係者を特定：

- **エンドユーザー**: 直接システムを使用する人
- **開発者**: 実装・保守を担当する人
- **利害関係者**: ビジネス価値に関心を持つ人

### Stage 3: ストーリー生成と優先度設定

各ペルソナのニーズを構造化して優先度を設定：

#### 要件カテゴリ

**機能要件**:
- コア機能（システムの核心価値）
- データ管理（CRUD操作）
- ユーザー管理（認証・権限）
- 外部連携（API・統合）

**非機能要件**:
- UI/UX（使いやすさ、レスポンシブ）
- パフォーマンス（速度、効率）
- セキュリティ（データ保護）
- 可用性（安定稼働）
- スケーラビリティ（成長対応）

**開発者要件**:
- テスト（ユニット、統合、E2E）
- 保守性（コード品質、ドキュメント）
- 拡張性（モジュール設計）
- 監視・デプロイ

## User Storyフォーマット

```
As a [役割]
I want [機能]
So that [価値]

Acceptance Criteria:
- [具体的な受け入れ条件]
```

**優先度判定基準**:
- **Must Have**: システムの核心価値
- **Should Have**: 品質・体験向上
- **Could Have**: あると便利な機能

## 実行プロセス

### 環境確認
```bash
# プロジェクト構造作成
test -d docs/cc-xp || mkdir -p docs/cc-xp
```

### 分析実行

ユーザー要求「$ARGUMENTS」について、3段階分析を実行：

1. **真の目的分析**: 背景の不満、根本問題、成功時の価値
2. **ペルソナ特定**: エンドユーザー、開発者、利害関係者
3. **ストーリー生成**: 要件をUser Story形式で整理

### Evidence-Driven仮説生成（重要）

**各ストーリーに以下を必ず含める：**

#### 1. 検証可能な仮説作成
仮説は必ず以下のフォーマットで生成する：

```
「[具体的な実装・機能]が[測定可能な条件]を達成することで、[対象ユーザー]の[測定可能な価値指標]が[具体的数値・率]以上[向上/達成]する」
```

**良い仮説例**:
- 「テトロミノ生成処理が100ms以内に完了し、形状精度100%を達成することで、プレイヤーの操作満足度が95%以上向上する」
- 「ログイン処理が2秒以内に完了し、セキュリティ要件100%準拠することで、ビジネスユーザーの利用継続率が90%以上向上する」

**避けるべき抽象的仮説**:
- ❌ 「正確な実装が体験の基盤となる」
- ❌ 「スムーズな操作感が重要」

#### 2. 定量的KPI設定の強制化
kpi_targetは必ず複数の数値基準を含める：

```
「[パフォーマンス指標]<[数値][単位]、[品質指標][数値]%、[完全性指標][数値]%、[追加指標]」
```

**KPI設定例**:
- 「処理時間<100ms、精度100%、成功率99%、全機能実装率100%」
- 「応答時間<2秒、セキュリティ準拠100%、UI応答性95%、エラー率<1%」

#### 3. 自動テスト可能なsuccess_metrics生成
各ストーリーに具体的測定項目をリスト化：

```
「1.[測定項目1]、2.[測定項目2]、3.[パフォーマンステスト]、4.[品質テスト]」
```

**success_metrics例**:
- 「1.各テトロミノ4×4マトリクス形状一致テスト、2.RGB色値精度テスト、3.生成時間パフォーマンステスト、4.ランダム生成統計テスト」
- 「1.認証API応答時間テスト、2.セキュリティトークン検証テスト、3.UI操作応答性テスト、4.エラーハンドリングテスト」

#### 4. 競合差別化要因の明示
各ストーリーに競合との差別化ポイントを必ず含める：

```
competition_analysis: "既存の[競合カテゴリ]との差別化において[具体的優位性]が決定的要因"
```

### backlog.yaml生成

分析結果を基にストーリーセットを生成し、backlog.yamlに記録します。

**Evidence-Driven必須メタデータ**:
```yaml
iteration:
  id: [timestamp]
  business_goal: "簡潔なビジネス目標"
  success_criteria: "成功基準"
  target_users: "対象ユーザー"

stories:
  - id: [story-id]
    title: "ストーリータイトル"
    description: "詳細説明"
    business_value: 1-10
    user_value: 1-10
    # Evidence-Driven TDD必須項目
    hypothesis: "上記フォーマットで検証可能な仮説"
    kpi_target: "複数数値基準を含む測定可能な目標"
    success_metrics: "自動テスト可能な具体的測定項目リスト"
    competition_analysis: "競合差別化要因"
    user_persona: "具体的対象ユーザー"
    business_context: "ビジネス背景"
    status: "selected"
    priority: "Must Have|Should Have|Could Have"
```

**生成時の品質チェック**:

各ストーリー生成後、以下を必ず確認：
1. ✅ hypothesis に具体的数値・測定条件が含まれている
2. ✅ kpi_target に複数の数値基準が設定されている  
3. ✅ success_metrics に4つ以上の具体的測定項目がリストされている
4. ✅ competition_analysis で明確な差別化要因が示されている

**品質チェック失敗時は再生成を実行**

### 完了確認

分析完了後、生成されたストーリーの概要と次ステップを表示。

**次のコマンド**: `/cc-xp:story` でストーリー詳細化を開始