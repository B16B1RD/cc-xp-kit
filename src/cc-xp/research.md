---
description: XP research – 実装前の技術調査と仕様確認（価値実現のための正確な知識獲得）
argument-hint: '[id] ※省略時は in-progress ストーリーを使用'
allowed-tools: Bash(date), Bash(echo), Bash(git:*), Bash(test), Bash(mkdir:*), Bash(grep), ReadFile, WriteFile, WebSearch, WebFetch, mcp__context7__*
---

# XP Research - 価値実現のための技術調査

## ゴール

実装前に**公式仕様・ドキュメント・ベストプラクティス**を調査し、価値を正確に実現するための知識基盤を構築する。AIの既存知識に頼らず、最新かつ正確な情報に基づいた実装を可能にする。

## XP原則

- **勇気**: 知らないことを認め、積極的に調査する
- **コミュニケーション**: 調査結果を明確に記録し共有
- **シンプリシティ**: 必要十分な調査に留める
- **フィードバック**: 調査不足は早期に発見し補完

## Git リポジトリ確認（必須）

**🚨 最初に必ず実行してください 🚨**

Gitリポジトリが初期化されているか確認してください。初期化されていない場合は以下を自動実行してください：

1. `git init` でリポジトリを初期化
2. `git branch -m main` でデフォルトブランチをmainに変更
3. `git add .` で全ファイルをステージング
4. `git commit -m "Initial commit"` で初期コミットを作成

Git設定（user.name, user.email）が未設定の場合も適切に設定してください。

## 現在の状態確認

### 対象ストーリーの特定

$ARGUMENTS が指定されている場合はその ID、なければ `in-progress` ステータスのストーリーを使用してください。

@docs/cc-xp/backlog.yaml から該当ストーリーの情報を取得：
- ID、タイトル、ステータス
- core_value（本質価値）
- minimum_experience（最小価値体験）
- hypothesis（検証すべき仮説）

**ステータスバリデーション**：
- 対象ストーリーが `in-progress` であることを確認
- `done` ステータスのストーリーは調査不要
- backlog が存在しない場合は、先に `/cc-xp:plan` と `/cc-xp:story` の実行を案内

### 既存調査結果の確認

`docs/cc-xp/research/[story-id]/` ディレクトリが既に存在するか確認：
- 存在する場合: 追加調査または更新として扱う
- 存在しない場合: 新規調査として開始

## Phase 1: 調査項目の特定

### 1. 実装領域の分析

ストーリーの内容から、調査が必要な技術領域を特定してください：

**技術カテゴリの判定**:
- **ゲーム開発**: ゲームルール、アルゴリズム、物理演算
- **Web開発**: フレームワーク、API、ブラウザ仕様
- **データ処理**: ファイル形式、データ構造、アルゴリズム
- **UI/UX**: デザインシステム、アクセシビリティ、インタラクション
- **インフラ**: デプロイ、CI/CD、クラウドサービス
- **セキュリティ**: 認証、暗号化、脆弱性対策

### 2. 調査項目リストの作成

以下の観点で調査項目を整理してください：

**必須調査項目**:
- 公式仕様・標準規格
- APIリファレンス
- 実装に必要なアルゴリズム
- 必須の依存関係

**推奨調査項目**:
- ベストプラクティス
- よくあるアンチパターン
- パフォーマンス最適化手法
- 参考実装・サンプルコード

**オプション調査項目**:
- 競合製品の分析
- ユーザーコミュニティの知見
- 将来の拡張性考慮事項

## Phase 2: 調査実行

### 1. 公式ドキュメントの検索

**WebSearchツールを活用**して、以下を検索してください：

```
"[技術名] official documentation"
"[技術名] specification"
"[技術名] API reference"
"[技術名] implementation guide"
```

**テトリス例**:
```
"Tetris Guideline official"
"Tetris SRS rotation system"
"Tetris 7-bag randomizer algorithm"
"Tetris scoring system standard"
```

### 2. 仕様の詳細確認

**WebFetchツールを活用**して、見つかった公式ドキュメントから重要な情報を抽出してください：

- 正確な仕様・ルール
- 必須要件と推奨要件
- 制約事項・制限事項
- バージョン情報・互換性

### 3. 実装サンプルの収集

**Context7ツール（利用可能な場合）**を活用して、関連するライブラリやフレームワークのドキュメントを取得してください：

```
mcp__context7__resolve-library-id で関連ライブラリを検索
mcp__context7__get-library-docs で詳細ドキュメントを取得
```

### 4. ベストプラクティスの調査

以下の情報を収集してください：

- 推奨される実装パターン
- 避けるべきアンチパターン
- パフォーマンス考慮事項
- セキュリティ考慮事項

## Phase 3: 調査結果の記録

### 調査ディレクトリの作成

`docs/cc-xp/research/[story-id]/` ディレクトリを作成してください。

### 1. specifications.md の作成

公式仕様と必須要件を記録：

```markdown
# 仕様書 - [ストーリータイトル]

## 公式仕様

### 基本仕様
- [仕様項目1]
- [仕様項目2]

### 必須要件
- [要件1]
- [要件2]

### 参照URL
- [公式ドキュメントURL]
- [仕様書URL]

## 重要な制約事項
- [制約1]
- [制約2]

## バージョン情報
- 仕様バージョン: [version]
- 最終確認日: [date]
```

### 2. implementation.md の作成

実装ガイドラインとベストプラクティスを記録：

```markdown
# 実装ガイド - [ストーリータイトル]

## 推奨実装アプローチ

### アーキテクチャ
[推奨される設計パターン]

### 主要アルゴリズム
```[language]
[サンプルコード]
```

### データ構造

```[language]
[データ構造定義]
```

## ベストプラクティス

- [プラクティス1]
- [プラクティス2]

## アンチパターン（避けるべき実装）

- ❌ [アンチパターン1]
- ❌ [アンチパターン2]

## パフォーマンス最適化

- [最適化手法1]
- [最適化手法2]
```

### 3. references.md の作成

参考リンクと追加リソースを記録：

```markdown
# 参考資料 - [ストーリータイトル]

## 公式リソース
- [公式サイト](URL)
- [APIドキュメント](URL)
- [チュートリアル](URL)

## コミュニティリソース
- [実装例1](URL)
- [実装例2](URL)
- [ブログ記事](URL)

## 関連ライブラリ
- [ライブラリ1]: [説明]
- [ライブラリ2]: [説明]

## 競合製品分析
- [製品1]: [特徴]
- [製品2]: [特徴]
```

### 4. decisions.md の作成

技術的決定事項と根拠を記録：

```markdown
# 技術的決定事項 - [ストーリータイトル]

## 決定事項

### 1. [決定項目1]
**決定**: [選択した方法]
**根拠**: [なぜこの方法を選んだか]
**代替案**: [検討した他の選択肢]

### 2. [決定項目2]
**決定**: [選択した方法]
**根拠**: [なぜこの方法を選んだか]
**代替案**: [検討した他の選択肢]

## リスクと対策
- **リスク1**: [内容]
  - **対策**: [対応方法]
- **リスク2**: [内容]
  - **対策**: [対応方法]

## 今後の検討事項
- [将来考慮すべき事項1]
- [将来考慮すべき事項2]
```

## Phase 4: backlog.yaml の更新

@docs/cc-xp/backlog.yaml の該当ストーリーに調査情報を追加：

```yaml
research_status: "completed"
research_completed_at: [現在時刻]
research_notes: |
  主要な調査結果の要約
  - [重要な発見1]
  - [重要な発見2]
specifications_url: [主要な公式ドキュメントURL]
```

## Phase 5: 調査品質の確認

### チェックリスト

調査完了前に以下を確認してください：

- [ ] 公式仕様を確認したか
- [ ] 実装に必要なアルゴリズムを理解したか
- [ ] ベストプラクティスを把握したか
- [ ] アンチパターンを認識したか
- [ ] 技術的決定事項を記録したか
- [ ] 参考実装を収集したか

### 調査の充実度評価

**高品質な調査** (★★★):
- 公式仕様を完全に把握
- 複数の実装例を参照
- ベストプラクティスを網羅
- 将来の拡張性も考慮

**標準的な調査** (★★):
- 必要最小限の仕様を把握
- 基本的な実装方法を理解
- 主要なアンチパターンを認識

**最小限の調査** (★):
- 基本仕様のみ確認
- 最低限の実装知識を獲得

## 変更のコミット

以下の手順でコミットしてください：

1. **対象ファイル**:
   - `docs/cc-xp/research/[story-id]/*.md`
   - `docs/cc-xp/backlog.yaml`
2. **コミットメッセージ**: "docs: 技術調査完了 - [ストーリータイトル]"

## 完了サマリーの表示

```
📚 技術調査完了
================
ストーリー: [タイトル]
調査時間: [所要時間]
調査品質: [★★★/★★/★]

📋 調査結果:
- 公式仕様: ✅ 確認済み
- 実装ガイド: ✅ 作成済み
- 参考資料: [X]件収集
- 技術決定: [Y]件記録

🔍 重要な発見:
• [発見1]
• [発見2]
• [発見3]

📁 調査結果の保存先:
docs/cc-xp/research/[story-id]/

⚠️ 注意事項:
• [特に注意すべき点1]
• [特に注意すべき点2]
```

## 次のステップ

```
🚀 次のステップ
================
調査結果に基づいてTDD開発を開始:
→ /cc-xp:develop

このコマンドで:
• 調査結果を参照しながら開発
• 正確な仕様に基づいた実装
• ベストプラクティスの適用

💡 開発のポイント
---------------
• specifications.md の仕様を厳守
• implementation.md のガイドに従う
• decisions.md の決定事項を反映
```

## エラーハンドリング

### 調査ツールが利用できない場合

WebSearch、WebFetch、Context7 が利用できない場合：
```
⚠️ 調査ツールが利用できません

代替手段:
1. ユーザーに直接URLを提供してもらう
2. ローカルのドキュメントを参照
3. 既存のコード例から学習
```

### 公式ドキュメントが見つからない場合

```
⚠️ 公式ドキュメントが見つかりません

対応方法:
1. コミュニティリソースを活用
2. デファクトスタンダードを調査
3. 類似技術から推測
4. ユーザーに確認を求める
```

## 重要な注意事項

- **過信の防止**: AIの既存知識だけに頼らず、必ず外部ソースを確認
- **最新性の確保**: 古い情報に注意し、最新の仕様を優先
- **実装可能性**: 理想的な仕様と実装可能な範囲のバランスを考慮
- **価値中心**: 技術的完璧さより、ユーザー価値の実現を優先