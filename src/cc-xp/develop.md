---
description: XP develop – Value-Driven TDD（価値駆動）による本質価値実現
argument-hint: '[id] ※省略時は in-progress ストーリーを使用'
allowed-tools: Bash(git:*), Bash(date), Bash(test), Bash(bun:*), Bash(npm:*), Bash(pnpm:*), Bash(uv:*), Bash(python:*), Bash(pytest:*), Bash(cargo:*), Bash(go:*), Bash(bundle:*), Bash(dotnet:*), Bash(gradle:*), Bash(npx:*), Bash(ls), WriteFile, ReadFile, mcp__playwright__*
---

# 🚨 絶対禁止事項 - 必読 🚨

## ⛔ STATUS = DONE への変更は絶対禁止 ⛔

```
🚨 CRITICAL WARNING 🚨
❌ develop では status: done への変更は絶対に禁止
❌ done に設定すると重大なワークフロー破壊が発生
❌ 一度でも done にすると後続処理に深刻な影響

✅ develop では必ず status: testing で停止
✅ done への変更は /cc-xp:review accept でのみ許可
✅ この禁止事項を違反した場合は即座にエラー停止
```

**🔒 三層防御システム 🔒**
- **防御層1**: 開始時の強制確認
- **防御層2**: 各フェーズでの status 確認  
- **防御層3**: 完了前の最終確認

---

# XP Develop - 価値駆動 TDD

## ゴール

**Value-Driven TDD** により、ユーザーが実際に価値を体験できるソフトウェアを実装する。

## 🛡️ 防御層1: 開始時の強制確認

### STEP 0-1: Git リポジトリ確認（最優先）

**🚨 最初に必ず実行してください 🚨**

Gitリポジトリが初期化されているか確認してください。初期化されていない場合は以下を自動実行してください：

1. `git init` でリポジトリを初期化
2. `git branch -m main` でデフォルトブランチをmainに変更
3. `git add .` で全ファイルをステージング
4. `git commit -m "Initial commit"` で初期コミットを作成

Git設定（user.name, user.email）が未設定の場合も適切に設定してください。設定が必要な場合はグローバル設定として自動設定してください。

### STEP 0-2: STATUS 原子的更新処理

**🚨 この処理を次に必ず実行 🚨**

backlog.yamlのステータスを原子的に更新してください。現在のステータスが `in-progress` の場合のみ `testing` に更新し、
既に `done` の場合は処理を停止してください。更新後は status が testing であることと updated_at が現在時刻になっていることを確認してください。

**✅ 更新完了の確認**: status=testing かつ updated_at=現在時刻

### STEP 1: 価値理解確認

backlog.yaml から確認。
- `core_value`（本質価値）が明確。
- `minimum_experience`（最小価値体験）が具体的。
- `value_story`が価値体験中心。

### STEP 1.5: 技術調査結果の確認（重要）

**📚 調査結果の確認**

`docs/cc-xp/research/[story-id]/` ディレクトリの存在を確認してください。

**調査結果が存在する場合**:
- `specifications.md` - 公式仕様を確認
- `implementation.md` - 実装ガイドラインを参照
- `decisions.md` - 技術的決定事項を確認
- `references.md` - 参考資料を活用

**調査結果が存在しない場合**:
```
⚠️ 技術調査が未実施です

正確な実装のため、先に調査を実施することを強く推奨します：
→ /cc-xp:research

調査をスキップする場合のリスク：
• 仕様の誤解による手戻り
• アンチパターンの実装
• 非効率な実装方法の選択
```

調査をスキップして続行する場合も、開発中に不明点があれば適宜調査を実施してください。

## 🛡️ 防御層2: Red-Green-Verify-Refactor フェーズ

### Phase 1: Value-First Red（価値優先失敗テスト）

**🚨 STEP 0-2でstatus確認済み - 安全に開始 🚨**

#### 1. 本質価値テスト作成

- `core_value`を検証するテスト
- ユーザーが実際に体験できることをテスト
- 技術的詳細ではなく、価値体験をテスト

#### 2. Red状態確認

- 価値体験テストが失敗（Red 状態）
- 失敗理由が「価値がまだ実現されていない」
- **重要**: テスト結果よりも実際の価値体験を重視

### Phase 2: Value-Driven Green（価値実現実装）

**🚨 STEP 0-2でstatus確認済み - 安全に続行 🚨**

#### 1. 本質価値実装

- `core_value`を実現する実装
- ユーザーが実際に価値を体験できる実装
- 「楽しい」「便利」と感じられる実装

#### 2. **価値体験確認（全プロジェクト必須）**

**🎯 実際の価値実現を確認する**:

**共通確認項目**:
- ユーザーが実際に価値を体験できるか？
- 期待通りに動作するか？
- エラーなく完了するか？

**プロジェクトタイプ別の動作確認**:

**Webアプリケーション**:
- 開発サーバーを起動（package.jsonの"dev"スクリプト）
- ブラウザでアクセスして実際の動作を確認
- ユーザー操作を実際に行い価値体験を検証

**CLIツール**:
- コマンドを実際に実行して動作確認
- 期待する出力・結果が得られるかテスト

**ライブラリ・API**:
- 簡単なテストスクリプトで実際に利用
- 期待する機能が動作するか確認

**🚨 重要**: テストの成功より実際の動作を優先する

### Phase 3: Value Verification（価値検証）

**🚨 STEP 0-2でstatus確認済み - 安全に検証 🚨**

#### 1. **実装完了後の必須検証**

**🎯 動作する価値実現の確認**:
- 実装したコードが実際に動作するか？
- ユーザーが期待する価値体験ができるか？  
- テスト結果に関わらず実際の動作を重視

**検証方法**:
- 手動テストによる動作確認
- 実際のユーザー操作シミュレーション
- 統合環境での動作テスト

**🚨 重要な判断基準**:
- **テスト成功 + 動作しない = 失敗**
- **テスト失敗 + 動作する = 要調査**  
- **テスト成功 + 動作する = 成功**

#### 2. 価値実現度の評価

以下の観点で価値実現を評価：
- **機能性**: 期待通りに動作する
- **使いやすさ**: ユーザーが容易に価値を得られる
- **信頼性**: エラーなく安定動作する

### Phase 4: Value-Maximizing Refactor（価値最大化の最適化）

**🚨 STEP 0-2でstatus確認済み - 安全に最適化 🚨**

#### 1. 品質最適化

- コードの可読性・保守性向上
- パフォーマンス最適化
- エラーハンドリング強化

## 🛡️ 防御層3: 完了前の最終確認

### STEP FINAL: 安全な最終確認

**🚨 この処理を完了前に必ず実行 🚨**

backlog.yamlの最終ステータスを確認してください。`status: testing` であることを確認し、testing 以外の場合（特に done の場合）は **CRITICAL ERROR** として処理を停止し、エラーメッセージを表示してください。

**✅ 最終確認**: status=testing のみで続行、それ以外は停止

### コミット処理

以下の手順でコミットを実行してください：

1. **backlog.yamlのコミット**:
   - ファイル: `docs/cc-xp/backlog.yaml`
   - メッセージ: "develop: ストーリーを testing に更新 - done 禁止厳守"

2. **実装ファイルのコミット**:
   - ファイル: 全ての変更ファイル（`.`）
   - メッセージ: "feat: 価値駆動TDD実装完了 - testing段階"

各コミット前に、ステージング、変更確認、コミット実行の手順を実行してください。

## 完了サマリー

開発完了後、以下を表示。

```
🎯 Value-Driven TDD 完了
=========================
ストーリー: [ストーリータイトル]
ブランチ: story-[ID]
ステータス: testing ✅

実施フェーズ:
✅ Value-First Red - 価値テスト作成
✅ Value-Driven Green - 価値実現実装
✅ Value Verification - 価値検証（動作確認）
✅ Value-Maximizing Refactor - 価値最大化

🚨 重要確認事項 🚨
✅ status = testing (done ではない)
✅ **実際に動作する価値体験が実装済み**
✅ 手動テストによる動作確認済み
✅ ユーザーが期待する価値を実際に体験可能
```

## 次のステップ

```
🚀 次のステップ
================
価値検証とレビューを実施:
→ /cc-xp:review

レビューオプション:
• accept - すべて満足時のみ
• reject "理由" - 修正要求
• skip - 判定保留

💡 重要
- status は testing のまま
- done への変更は review accept でのみ
```

## エラーハンドリング

### status が done になった場合の安全対応

backlog.yamlで`status: done`を検出した場合は、**CRITICAL ERROR** として処理を停止し、以下のエラーメッセージを表示してください：

```
⛔ CRITICAL ERROR: developでstatus=doneへの不正変更を検出
⚙️ 原因: 並列実行や競合状態による意図しない変更
🔄 対応: review reject で in-progress に戻し、この問題を修正後に再実行
```

**重要**: 自動修正は行わず、ユーザーの手動対応を求める

## 重要な注意事項

- **🚨 絶対禁止**: develop で status を done にすることは絶対禁止
- **✅ 必須**: 各フェーズで status 確認する
- **🔒 防御**: 三層防御システムで完全ガード
- **⚡ 緊急**: done 検出時は即座に停止・修正

この防御システムにより、status=done 問題を完全に解決します。